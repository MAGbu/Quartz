<?php//============================================================//Filename : register.php//Variables ://  $_POST://      'submit' - has submit button been pressed.//      'name' - users name submitted.//      'email' - users email address.//      'email2' - email address confirmation.//      'pass' - users password.//      'pass2' - password confirmation.//      'buid' - users BU ID number.//  $_SESSION://      'frmerror' - an error flag for the registration form.////============================================================//Comments End Here===========================================    session_start();	$thisfilename = "register.php";?><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html>    <head>        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">        <link rel="stylesheet" type="text/css" href="Style.css" />        <title></title>    </head>    <body bgcolor="#EEEEEE">        <?php            //Include website header.			$headerincludedfrom = "register.php";            include 'dbvars.php';            include 'header.php';            // If the user has submitted the registration form			// print("register.php@0 is POST['submit'] set? ".(isset($_POST['submit'])?"true":"false"));			// die();            if (isset($_POST['submit']))            {                // If there are any errors in the registration form set appropriate error code                if (!$_POST['name'] | !$_POST['email'] | !$_POST['email2']                	| !$_POST['pass'] | !$_POST['pass2'] | !$_POST['buid']                	| ($_POST['email2'] != $_POST['email'])                	| ($_POST['pass2'] != $_POST['pass'])                	| substr($_POST['email'],strlen($_POST['email'])-7,7) != "@bu.edu")                {                    if (!$_POST['name'])                    {                        $_SESSION['frmerror'] = 1;                    }                    else if (!$_POST['email'])                    {                        $_SESSION['frmerror'] = 2;                    }                    else if ($_POST['email2'] != $_POST['email'])                    {                        $_SESSION['frmerror'] = 4;                    }                    else if (!$_POST['pass'])                    {                        $_SESSION['frmerror'] = 8;                    }                    else if ($_POST['pass2'] != $_POST['pass'])                    {                        $_SESSION['frmerror'] = 16;                    }                    else if (!$_POST['buid'])                    {                        $_SESSION['frmerror'] = 32;                    }                    else if (substr($_POST['email'],strlen($_POST['email'])-7,7) != "@bu.edu")                    {                        $_SESSION['frmerror'] = 4;                    }                    //Since an error was encountered display the registration form again.                	$regformincludedfrom = "register.php@3";                    include 'regform.php';                }                else                {                    // No errors were encountered in the registration form                    $_SESSION['frmerror'] = 0;                    // Create a connection to the MySQL server                    mysql_connect($serverurl, $adminname, $adminp) or die(mysql_error());                    // Select database                    mysql_select_db($dbname) or die(mysql_error());                    // Store data in local variables                    $email = $_POST['email'];                    $pass = $_POST['pass'];                    // Check if an account with the name already exists                    $check = mysql_query("SELECT * FROM nLogin WHERE email = '$email'")or die(mysql_error());                    $check2 = mysql_num_rows($check);                    // If an account with the name exists then show the registration form again                    if ($check2 != 0)                    {                        $_SESSION['frmerror'] = -1;                		$regformincludedfrom = "register.php@5";                        include 'regform.php';                        include 'footer.php';                        die();                    }                    // Check if an account with the name is createable                    $check = mysql_query("SELECT * FROM loginSet WHERE email = '$email'")or die(mysql_error());                    $check2 = mysql_num_rows($check);                    // If an account with the name exists then show the registration form again                    if ($check2 != 0)                    {                        $_SESSION['frmerror'] = -1;                 		$regformincludedfrom = "register.php@6".$check2;                       	include 'regform.php';                        include 'footer.php';                        die();                    }                    // Encrypt password with MD5(one way hash) encryption                    $_POST['pass'] = md5($_POST['pass']);                    // Add a record to the user database                    $insert = "INSERT INTO nLogin (email, password, name, buid, isactive) VALUES ('".$_POST['email']."', '".$_POST['pass']."', '".$_POST['name']."', '".$_POST['buid']."', 1)";                    $add_member = mysql_query($insert);                    // Get the BU username of the user                    $_SESSION['uname'] = substr($_POST['email'],0,strlen($_POST['email'])-7);                    // Create a new directory for the user                    if (!file_exists($_SESSION['uname']))                    {                        mkdir($_SESSION['uname']);                    }                    // Copy the website template to the new folder                    copy("./template/index.php","./".substr($_POST['email'],0,strlen($_POST['email'])-7)."/index.php");                    copy("./template/email_img.php","./".substr($_POST['email'],0,strlen($_POST['email'])-7)."/email_img.php");                    copy("./template/construction.php","./".substr($_POST['email'],0,strlen($_POST['email'])-7)."/construction.php");                    copy("./template/picture.jpg","./".substr($_POST['email'],0,strlen($_POST['email'])-7)."/picture.jpg");                    copy("./template/awards.html","./".substr($_POST['email'],0,strlen($_POST['email'])-7)."/awards.html");                    copy("./template/personal.html","./".substr($_POST['email'],0,strlen($_POST['email'])-7)."/personal.html");                    copy("./template/projects.html","./".substr($_POST['email'],0,strlen($_POST['email'])-7)."/projects.html");                    copy("./template/students.html","./".substr($_POST['email'],0,strlen($_POST['email'])-7)."/students.html");        ?>            <center>                <div style="position: relative; <?php if (strstr($_SERVER['HTTP_USER_AGENT'],"Mozilla") != "") echo 'top:-15px;'; ?> width: 945px; height: 200px; background: url('images/Body.jpg');">                    <br><br>Your account has been created and is waiting for admin approval. You will receive an email within 24 hours.<br><br>                </div>            </center>        <?php                }            }            else            {                // if the user did not press submit yet then display the registration form                $regformincludedfrom = "register.php@9";                include 'regform.php';            }            include 'footer.php';        ?>    </body></html>